# Data Model: GitHub Actions CI/CD Workflow

**Feature**: `001-have-github-actions` | **Date**: 2025-10-06

## Overview

This document defines the entities, states, and relationships for the GitHub Actions CI/CD workflow. Since this is infrastructure-as-code, the "data model" represents workflow execution state and job lifecycles rather than persisted database entities.

## Entities

### 1. Workflow Run

**Description**: A single execution instance of the CI/CD pipeline, triggered by a push to the main branch.

**Attributes**:

- **ID**: Auto-generated by GitHub Actions (run ID)
- **Trigger Event**: `push` to `main` branch
- **Commit SHA**: Git commit that triggered the workflow
- **Timestamp**: Workflow start time
- **Status**: `queued` → `in_progress` → `completed` (with conclusion: success/failure/cancelled)
- **Duration**: Total time from start to completion
- **Jobs**: Collection of 4 jobs (build, test-unit, test-e2e, summary)

**Lifecycle**:

```
Push to main → Workflow Queued → Build Starts → Tests Start (parallel)
→ Summary Generation → Workflow Complete
```

**Validation Rules**:

- Only one workflow type per trigger event
- Must complete within GitHub Actions timeout (default 6 hours, realistically <10 minutes)
- Workflow status determined by critical job outcomes (build, tests)

**Relationships**:

- **Contains**: Multiple jobs (1:4 relationship)
- **Triggered By**: Git push event (1:1)
- **Associated With**: Single commit SHA (1:1)

---

### 2. Build Job

**Description**: Compilation and build verification job that produces production-ready artifacts.

**Attributes**:

- **Job Name**: `build`
- **Runner**: `ubuntu-latest`
- **Status**: `pending` → `running` → `completed` (success/failure)
- **Duration**: Target <2 minutes
- **Node Version**: 22+
- **Outputs**: Build artifacts (dist/ directory)
- **Dependencies**: None (first job in pipeline)

**Lifecycle**:

```
Job Starts → Checkout Code → Setup Node → Install Dependencies (cached)
→ Run Build (make build) → Upload Artifacts (on failure) → Job Complete
```

**Validation Rules**:

- Must succeed before tests can run
- Build failure stops entire workflow (tests skipped)
- TypeScript compilation errors cause failure
- Vite build errors cause failure

**Relationships**:

- **Prerequisite For**: Unit Test Job, E2E Test Job
- **Produces**: Build artifacts
- **Part Of**: Workflow Run

---

### 3. Unit Test Job

**Description**: Component test execution using Vitest.

**Attributes**:

- **Job Name**: `test-unit`
- **Runner**: `ubuntu-latest`
- **Status**: `pending` → `running` → `completed` (success/failure)
- **Duration**: Target <2 minutes
- **Node Version**: 22+
- **Test Framework**: Vitest
- **Outputs**: Test results
- **Dependencies**: Build job (runs after build succeeds)

**Lifecycle**:

```
Build Succeeds → Job Starts → Checkout → Setup Node → Install Dependencies
→ Run Tests (make ci.test) → Job Complete
```

**Validation Rules**:

- Skipped if build fails
- Any test failure causes job failure
- Runs in parallel with E2E test job

**Relationships**:

- **Depends On**: Build Job (sequential dependency)
- **Runs Parallel With**: E2E Test Job
- **Part Of**: Workflow Run

---

### 4. E2E Test Job

**Description**: End-to-end browser test execution using Playwright.

**Attributes**:

- **Job Name**: `test-e2e`
- **Runner**: `ubuntu-latest`
- **Status**: `pending` → `running` → `completed` (success/failure)
- **Duration**: Target <3 minutes
- **Node Version**: 22+
- **Test Framework**: Playwright
- **Browser**: Chromium (installed via npx playwright install chromium)
- **Outputs**: Test reports, screenshots (on failure)
- **Dependencies**: Build job (runs after build succeeds)

**Lifecycle**:

```
Build Succeeds → Job Starts → Checkout → Setup Node → Install Dependencies
→ Install Playwright Browsers → Run E2E Tests (make test.e2e)
→ Upload Test Results (on failure) → Job Complete
```

**Validation Rules**:

- Skipped if build fails
- Any test failure causes job failure
- Playwright browsers must be installed before tests
- Test reports uploaded only on failure (for debugging)
- Runs in parallel with unit test job

**Relationships**:

- **Depends On**: Build Job (sequential dependency)
- **Runs Parallel With**: Unit Test Job
- **Produces**: Test result artifacts (conditional on failure)
- **Part Of**: Workflow Run

---

### 5. Workflow Summary Job

**Description**: Generates and displays consolidated summary of all job results.

**Attributes**:

- **Job Name**: `summary`
- **Runner**: `ubuntu-latest`
- **Status**: `pending` → `running` → `completed` (always succeeds)
- **Duration**: Target <10 seconds
- **Execution Condition**: `if: always()` (runs regardless of failures)
- **Dependencies**: All jobs (build, test-unit, test-e2e)
- **Output Format**: GitHub Actions markdown summary

**Lifecycle**:

```
All Jobs Complete or Failed → Job Starts → Collect Job Statuses
→ Generate Markdown Summary → Write to $GITHUB_STEP_SUMMARY → Job Complete
```

**Validation Rules**:

- Must run even if all previous jobs fail
- Summary displays status of all jobs (success/failure/skipped)
- Uses needs context to access job results
- Summary visible in GitHub Actions UI

**Relationships**:

- **Depends On**: All jobs (build, test-unit, test-e2e)
- **Consumes**: Job status information via needs context
- **Produces**: Markdown summary (GitHub Actions UI)
- **Part Of**: Workflow Run

---

### 6. Workflow Artifact

**Description**: Files generated during workflow execution and retained for debugging/analysis.

**Attributes**:

- **Artifact Types**:
  - Build outputs (dist/)
  - Test reports (playwright-report/)
- **Retention Period**: 3 days
- **Upload Conditions**:
  - Build artifacts: Only on failure
  - Test reports: Only on E2E failure
- **Storage**: GitHub Actions artifact storage
- **Access**: Downloadable from workflow run page

**Lifecycle**:

```
Job Produces Files → Upload Artifact Action → Stored in GitHub
→ Available for 3 Days → Automatic Deletion
```

**Validation Rules**:

- Each artifact must have unique name
- Retention period: exactly 3 days
- Size limits: Per GitHub Actions constraints (10GB repo limit)
- Conditional uploads based on job outcomes

**Relationships**:

- **Produced By**: Build, Test jobs
- **Associated With**: Workflow Run (1:many)

---

## State Transitions

### Workflow Run State Machine

```
QUEUED → IN_PROGRESS → COMPLETED
                       ├─ success (all critical jobs passed)
                       ├─ failure (any critical job failed)
                       └─ cancelled (manual cancellation)
```

### Job State Machine

```
PENDING → RUNNING → COMPLETED
                    ├─ success (job completed successfully)
                    ├─ failure (job encountered errors)
                    ├─ skipped (dependency failed)
                    └─ cancelled (workflow cancelled)
```

### Critical vs Non-Critical Jobs

**Critical** (workflow fails if these fail):

- Build
- Unit Tests
- E2E Tests

**Non-Critical** (workflow continues if these fail):

- Summary (always runs via if: always())

---

## Data Flow

```
Push Event (main branch)
  ↓
Workflow Run Created
  ↓
Build Job → dist/ artifacts (conditional upload)
  ↓
  ├─→ Unit Test Job → test results
  └─→ E2E Test Job → playwright-report/ (conditional upload)
  ↓
Summary Job ← Collects all job statuses
  ↓
Workflow Summary (GitHub UI)
```

---

## Notes

- **No Persistent Storage**: Workflow state managed entirely by GitHub Actions, no custom database
- **Artifact Lifecycle**: Auto-deleted after 3 days, no manual cleanup required
- **Idempotency**: Multiple workflow runs independent, no shared state between runs
- **Concurrency**: Multiple workflow runs can execute concurrently for different commits

---

**Data model complete. Ready for contract definition and test scenario design.**
